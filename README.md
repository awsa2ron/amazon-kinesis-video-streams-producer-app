This project is an optimized, portable Linux application that uses the [Kinesis Video Streams Producer C SDK](https://github.com/awslabs/amazon-kinesis-video-streams-producer-c) to securely ingest video to the [Amazon Kinesis Video Streams](https://aws.amazon.com/kinesis/video-streams/) service on [Unix-like](https://en.wikipedia.org/wiki/Unix-like) systems.

This application implemented the following features:

* Creating a stream.
* Packaging frames and fragments generated by the device's media pipeline. 
* Token rotation for secure and uninterrupted streaming.
* Processing acknowledgements returned by Kinesis Video Streams
* Scheduler for video and audio put routines.


The application has been fine tuned for resource limited embedded device such as consumer IP cameras. It sets video buffer to the minimum size and reduces flash usage.

## Memory Consumption

### ROM

About 1.2MB on ARM 32-bit architecture.

### RAM

Less than 4MB.

*Background: The sample app contained in the  *[*Kinesis Video Streams Producer C SDK*](https://github.com/awslabs/amazon-kinesis-video-streams-producer-c)*  consumes more than 4MB ROM and 18MB RAM, when it uses minimum video buffer size.*

## System Requirement

This application runs on any Linux system with a file system and internet connection.  It builds in all the libraries statically, so should require nothing to be installed ahead of time.

## Download and Build

```
`# git clone <somewhere>`
`cd amazon``-``kinesis``-``video``-``streams``-``producer``-``app`
mkdir build
cd build
# export CC if cross compile
cmake .. -DBUILD_STATIC=TRUE -DUSE_OPENSSL=FALSE -DUSE_MBEDTLS=TRUE
make

# Long options
$ ./kvs --channel-name your-kvs-name \
                            --directory ../ \
                            --duration 600 \
                            --size 2048
# Or short options
$ ./kvs -n your-kvs-name -D 600 -d ../ -s 2048
```


You can use the following configuration interface to customize the application.


```
$ ./kvs --help
Ingest video to the Amazon Kinesis Video Streams service.
Usage: 
AWS_ACCESS_KEY_ID=SAMPLEKEY AWS_SECRET_ACCESS_KEY=SAMPLESECRET
kvs [OPTION]...

-n, --channel-name     stream channel name
                       default to 'your-kvs-name'
-d, --directory        streaming media directory
                       default to '../'
-D, --duration         streaming duration in second
                       default to 600
-s, --size             stream buffer size in KB
                       default to 2048, minimal to 1024

Exit status:
     0  if OK,
     1  if minor problems (e.g., missing argument),
     others  if serious trouble, please check 'Include.h' files.

```



## License

This solution is licensed under the MIT License. See the LICENSE file.
